<openerp>
  <data noupdate="0">

    <!-- Student Registration -->
    <record id="view_school_registration_tree" model="ir.ui.view">
      <field name="name">school.registration.tree</field>
      <field name="model">school.registration</field>
      <field name="arch" type="xml">
        <tree string="Classes" colors="red:state=='cancel';grey:state=='suspend'">
          <field name="year_id"/>
          <field name="name"/>
          <field name="student_id"/>
          <field name="class_id"/>
          <field name="state"/>
        </tree>
      </field>
    </record>

    <record id="view_school_registration_form" model="ir.ui.view">
      <field name="name">school.registration.form</field>
      <field name="model">school.registration</field>
      <field name="arch" type="xml">
        <form string="Registration" version="7.0">
          <header>
            <button name="validate" states="draft" string="Validate" class="oe_highlight" groups="school.group_school_headteacher"/>
            <button name="generate_invoice" type="object" states="registered"
              string="Generate Invoice"
              groups="account.group_account_user"/>
            <button name="cancel_invoice" type="object" states="registered"
              string="Cancel Invoice"
              groups="account.group_account_user"/>
            <button name="cancel" states="registered" string="Cancel" groups="school.group_school_manager"/>
            <button name="registration_draft" states="cancel" string="Set to Draft" type="object" />
            <field name="state" widget="statusbar" statusbar_visible="draft,registered" statusbar_colors='{"cancel":"red"}'/>
          </header>
          <sheet>
            <h1> <label string="No"/> <field name="name" class="oe_inline"/> </h1>
            <separator string="Registration Information"/>
            <group>
              <group>
                <field name="student_id" context="{'stage':'enrolment'}"/>
                <field name="class_id" on_change="onchange_class_id(class_id)"/>
              </group>
              <group>
                <field name="user_id"/>
                <field name="registration_checklist_id" on_change="onchange_checklist_id(registration_checklist_id)"/>
              </group>
            </group>
            <notebook name="details">
              <page string="Checklist">
                <field name="checklist_ids" context="{'registration_id': active_id}">
                  <tree string="Checklist" editable="bottom">
                    <field name="item_id"/>
                    <field name="done"/>
                  </tree>
                </field>
              </page>
              <page string="Financial">
                <group>
                <field name="tuition_fee_id"/>
                  <field name="invoice_id"/>
                  <field name="invoice_state"/>
                </group>
              </page>
            </notebook>
          </sheet>
          <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
            <field name="message_ids" widget="mail_thread"/>
          </div>
        </form>
      </field>
    </record>

    <record id="view_school_registration_filter" model="ir.ui.view">
      <field name="name">school.registration.filter</field>
      <field name="model">school.registration</field>
      <field name="arch" type="xml">
        <search string="Search Registrations">
          <field name="class_id"/>
          <field name="student_id"/>
          <group expand="0" string="Group By..." >
            <filter string="Year" domain="[]" context="{'group_by':'year_id'}"/>
            <filter string="Class" domain="[]" context="{'group_by':'class_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <record id="action_school_registration" model="ir.actions.act_window">
      <field name="name">Registrations</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">school.registration</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'stage': 'administrative'}</field>
      <field name="search_view_id" ref="view_school_registration_filter"/>
      <field name="view_id" ref="view_school_registration_tree"/>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">
          Click to create a new registration.
        </p>
      </field>
    </record>

    <record id="action_school_registration_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_school_registration_tree"/>
        <field name="act_window_id" ref="action_school_registration"/>
    </record>
    <record id="action_school_registration_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_school_registration_form"/>
        <field name="act_window_id" ref="action_school_registration"/>
    </record>

    <menuitem action="action_school_registration"
      id="menu_school_registration"
      groups="school.group_school_headteacher"
      parent="menu_school_student_root" sequence="2" />


    <record id="action_school_registration_pop" model="ir.actions.act_window">
      <field name="name">Register Student</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">school.registration</field>
      <field name="view_type">form</field>
      <field name="view_mode">form</field>
      <field name="context">{'default_student_id': student_id, 'student_id': student_id}</field>
      <field name="view_id" ref="view_school_registration_form"/>
      <field name="target">current</field>
    </record>



    <!-- Student academic -->
    <record id="view_school_student_registered_tree" model="ir.ui.view">
      <field name="name">school.registration.tree.academic</field>
      <field name="model">school.registration</field>
      <field name="arch" type="xml">
        <tree string="Students" colors="red:state=='cancel';grey:state=='suspend'">
          <field name="student_id"/>
          <field name="class_id"/>
          <field name="class_state" invisible="1"/>
          <field name="state" invisible="1"/>
        </tree>
      </field>
    </record>

    <record id="view_school_student_registered_form" model="ir.ui.view">
      <field name="name">school.registration.form.academic</field>
      <field name="model">school.registration</field>
      <field name="arch" type="xml">
        <form string="Student" version="7.0">
          <sheet>
            <group>
              <group>
                <field name="student_id" readonly="1"/>
              </group>
              <group>
                <field name="class_id"/>
              </group>
            </group>
            <notebook name="academics">
              <page string="Grades">
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="view_school_student_registered_filter" model="ir.ui.view">
      <field name="name">school.registration.filter.academic</field>
      <field name="model">school.registration</field>
      <field name="arch" type="xml">
        <search string="Search Students">
          <field name="student_id"/>
          <filter icon="terp-check" name="open" string="Current" domain="[('class_state','=','open')]"/>
          <separator/>
          <group expand="0" string="Group By..." >
            <filter string="Class" domain="[]" context="{'group_by':'current_class_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <record id="action_school_student_registered" model="ir.actions.act_window">
      <field name="name">Students</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">school.registration</field>
      <field name="view_mode">tree,form</field>
      <field name="view_type">form</field>
      <field name="context">{'stage': 'academic', 'search_default_open': 1}</field>
      <field name="search_view_id" ref="view_school_student_registered_filter"/>
      <field name="view_id" ref="view_school_student_registered_tree"/>
      <field name="target">current</field>
    </record>

    <record id="action_school_student_registered_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_school_student_registered_tree"/>
        <field name="act_window_id" ref="action_school_student_registered"/>
    </record>
    <record id="action_school_student_registered_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_school_student_registered_form"/>
        <field name="act_window_id" ref="action_school_student_registered"/>
    </record>

    <menuitem action="action_school_student_registered" id="menu_school_academic_student_registered" parent="menu_school_academic" sequence="3" />


    <!-- Enrolment -->
    <record id="view_school_student_registration_form" model="ir.ui.view">
      <field name="name">school.student.form.registration.inherit</field>
      <field name="model">school.student</field>
      <field name="inherit_id" ref="school.view_school_enrolment_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='user_id']" position="after">
          <field name="current_class_id" invisible="1"/>
        </xpath>
        <xpath expr="//page[@string='Relatives']" position="after">
          <page string="Registrations">
            <field name="registration_ids" context="{'default_student_id': active_id}">
              <tree string="Student Roll">
                <field name="year_id"/>
                <field name="name" />
                <field name="class_id"/>
              </tree>
            </field>
          </page>
        </xpath>
        <xpath expr="//button[@name='validate']" position="after">
          <button name="%(action_school_registration_pop)d"
            string="Register"
            context="{'student_id':active_id}"
            type="action"
            groups="school.group_school_headteacher"
            attrs="{'invisible': ['|',('current_class_id','&lt;&gt;', False),'|',('state','&lt;&gt;','student')]}"
            class="oe_highlight"/>
        </xpath>

      </field>
    </record>

  </data>
</openerp>
